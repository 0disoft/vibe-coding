일단 큰 그림부터 말하면,
2024-09-13 이후의 marked는 세 번 크게 출렁였습니다.

* 15.0.0에서 HTML 이스케이프 위치가 바뀌고
* 16.0.0에서 사실상 ESM·Node 20+ 시대로 넘어가고
* 17.0.0에서 리스트/체크박스 토큰 구조가 재정비된 것.

나머지는 그 세 파도를 보조하는 패치와 확장용 후크 추가에 가깝습니다.

---

## 1. 2024-09-13 ~ 2025-12-07 릴리스 타임라인

아래 날짜·버전 정보는 marked 공식 GitHub Releases 기준입니다.([GitHub][1])

| 날짜         | 버전      | 타입  | 한줄 요약                                                |
| ---------- | ------- | --- | ---------------------------------------------------- |
| 2024-10-15 | 14.1.3  | 패치  | em/strong 마스킹, CLI 도움말 관련 버그 수정                      |
| 2024-11-07 | 14.1.4  | 패치  | 토큰 텍스트 변경 방지 등 버그 수정                                 |
| 2024-11-09 | 15.0.0  | 메이저 | HTML 이스케이프 위치 변경, 여러 파서 관련 수정 (브레이킹)                 |
| 2024-11-18 | 15.0.1  | 패치  | 회귀 버그 수정 위주                                          |
| 2024-11-20 | 15.0.2  | 패치  | 추가 버그 수정                                             |
| 2024-11-29 | 15.0.3  | 패치  | 버그 수정·안정화                                            |
| 2024-12-15 | 15.0.4  | 패치  | 버그 수정·안정화                                            |
| 2025-01-02 | 15.0.5  | 패치  | 패치 릴리스 (버그 수정)([GitHub][2])                          |
| 2025-01-06 | 15.0.6  | 패치  | 패치 릴리스 (버그 수정)                                       |
| 2025-02-10 | 15.0.7  | 패치  | 패치 릴리스 (버그 수정)                                       |
| 2025-04-07 | 15.0.8  | 패치  | 패치 릴리스 (버그 수정)                                       |
| 2025-04-21 | 15.0.9  | 패치  | 패치 릴리스 (버그 수정)                                       |
| 2025-04-23 | 15.0.10 | 패치  | 패치 릴리스 (버그 수정)                                       |
| 2025-04-25 | 15.0.11 | 패치  | 패치 릴리스 (버그 수정)                                       |
| 2025-05-20 | 15.0.12 | 패치  | 패치 릴리스 (버그 수정)([GitHub][2])                          |
| 2025-06-27 | 16.0.0  | 메이저 | CJS 빌드 제거, 최소 Node 20으로 상향 (브레이킹)                    |
| 2025-07-17 | 16.1.0  | 마이너 | 파서 제네릭 타입 추가 (타입 시스템 개선)                             |
| 2025-07-18 | 16.1.1  | 패치  | em/strong 토큰 관련 버그 수정([GitHub][1])                   |
| 2025-08-04 | 16.1.2  | 패치  | 멀티라인 리스트 아이템 개행 처리 수정([GitHub][1])                   |
| 2025-08-18 | 16.2.0  | 마이너 | Tokens.Def 및 Renderer.def 추가([GitHub][1])            |
| 2025-08-27 | 16.2.1  | 패치  | 링크 텍스트의 이스케이프된 개행 허용([GitHub][1])                    |
| 2025-09-14 | 16.3.0  | 마이너 | emStrongMask 훅 추가([GitHub][1])                       |
| 2025-10-07 | 16.4.0  | 마이너 | async provideParser / provideLexer 훅 추가([GitHub][1]) |
| 2025-10-17 | 16.4.1  | 패치  | 백틱 관련 우선순위 버그 수정([GitHub][1])                        |
| 2025-11-06 | 16.4.2  | 패치  | 정규식 lookbehind 회피 (브라우저 호환 개선)([GitHub][1])          |
| 2025-11-07 | 17.0.0  | 메이저 | 리스트·체크박스 토큰 구조 변경 (브레이킹)([NewReleases][3])           |
| 2025-11-20 | 17.0.1  | 패치  | task item 내부 블록 요소 버그 수정                             |

여기서 “실제 코딩에 꼭 알아야 할 것”만 다시 추리면 아래 정도입니다.

---

## 2. 실제 코드에 영향 큰 변경만 추린 표

| 버전     | 변화 유형 | 핵심 내용                                                                  | 코드에 미치는 영향                                                             | 대응·마이그레이션 요약                                                        |
| ------ | ----- | ---------------------------------------------------------------------- | ---------------------------------------------------------------------- | ------------------------------------------------------------------- |
| 15.0.0 | 브레이킹  | HTML 이스케이프를 토크나이저가 아니라 렌더러에서 처리하도록 변경                                  | 토큰의 text 등 필드를 직접 출력하던 코드에서 예상보다 덜/더 이스케이프될 수 있음                       | 토큰을 직접 문자열로 쓰기보다 Renderer를 통해 출력하고, 커스텀 렌더러에서는 이스케이프 중복 여부를 점검      |
| 16.0.0 | 브레이킹  | CJS 빌드 제거, 최소 Node 버전 20으로 상향                                          | require('marked') 패턴은 깨질 가능성이 크고, 구 Node 런타임에서는 공식 지원 범위 밖             | ESM import로 전환, CJS 환경에서는 동적 import 또는 번들링을 통해 사용                   |
| 16.1.0 | 타입 기능 | Parser/Renderer 제네릭 타입 추가([jsDocs.io][4])                              | TS 프로젝트에서 marked.parse의 결과 타입을 더 정확하게 모델링 가능                           | 커스텀 파서·렌더러를 쓰는 경우 제네릭 파라미터를 명시해 타입 안정성 강화                           |
| 16.2.0 | 기능 추가 | Tokens.Def 및 Renderer.def 도입([GitHub][1])                              | 링크 정의(definition)를 토큰 레벨에서 다룰 수 있어 확장성 증가                              | walkTokens나 커스텀 렌더러에서 Def 토큰을 활용해 문서 메타데이터나 레퍼런스 맵을 만들 수 있음         |
| 16.3.0 | 기능 추가 | emStrongMask 훅 추가([GitHub][1])                                         | 특정 구간을 em/strong 토큰화 대상에서 제외 가능                                        | 수학 수식, 템플릿 구문 등에서 원하는 부분만 강조 파싱 되게 조정 가능                            |
| 16.4.0 | 기능 추가 | async provideLexer / provideParser 훅 추가([GitHub][1])                   | 토크나이저/파서를 완전히 교체하면서도 비동기 로직을 섞을 수 있음                                   | 원격 스키마 조회, DB 기반 확장 마크다운 등을 구현할 때 marked.use(hooks)로 자체 렉서/파서를 주입   |
| 17.0.0 | 브레이킹  | 리스트 내부 텍스트 토큰 처리 방식 변경, listItem 렌더러 단순화, 체크박스 토큰 도입([NewReleases][3]) | 커스텀 list/listItem/checkbox 렌더러나 토큰 후처리를 하던 코드에서 토큰 구조가 달라져 동작이 바뀔 수 있음 | 리스트 토큰 구조를 다시 확인하고, Tokens.Checkbox·Tokens.ListItem를 기준으로 로직 재작성 필요 |

이제 각각을 조금 더 코드 관점에서 풀어볼게요.

---

## 3. 버전별로 자세히 보면 뭐가 달라졌나

### 3-1. 15.0.0 – HTML 이스케이프 위치 이동

핵심 문장 하나로 정리하면:

> “토크나이저가 하던 HTML 이스케이프를 렌더러가 맡게 됐다.”

그래서 생기는 영향은 대략 이런 것들입니다.

* 기존에 `token.text`를 그대로 innerHTML에 박아 넣던 코드는
  예전엔 “이미 이스케이프된 텍스트”라고 가정해도 비교적 안전했는데
  이제는 “원본에 더 가까운 텍스트”일 가능성이 커졌습니다.
* 반대로, 커스텀 렌더러에서 직접 HTML 이스케이프를 하던 경우
  15 이후에는 “기본 렌더러도 이스케이프를 수행”하기 때문에
  이중 이스케이프 위험이 생깁니다.

실무적으로는 이렇게 정리할 수 있습니다.

1. 가능하면 토큰을 직접 문자열로 출력하지 말고
   marked의 Renderer를 통해서만 HTML을 만들기.
2. 커스텀 Renderer를 재정비:

   * 내가 이미 `escape`를 한 번 더 호출하고 있지 않은지 확인
   * `dangerouslySetInnerHTML` 같은 곳에 토큰 값을 바로 넘기던 코드는 재검토

만약 토큰을 직접 써야 한다면:

* “이 값이 이스케이프된 값인지, 원본 값인지”를 주석이나 타입으로 명시해 두는 게 좋습니다.

---

### 3-2. 16.0.0 – ESM·Node 20+로 완전 전환

릴리스 노트에서 눈에 띄는 부분 두 개입니다.

* CJS 빌드 제거
* 최소 Node 버전 20으로 상향

그래서 생기는 현실적인 변화:

* Node에서 `require('marked')`를 그대로 쓰던 코드는
  16.0.0 이후에는 동작이 깨질 수 있습니다.
* “옛날 Node 16/18 서버에서 그냥 npm install 해서 돌리던” 코드는
  16.x 이상으로 올리면 공식 지원 범위 밖입니다.

권장 패턴은 이렇게 바뀝니다.

```js
// ESM 환경
import { marked } from 'marked';

const html = marked('# Hello');
```

CJS만 가능한 환경이라면 둘 중 하나를 선택해야 합니다.

* 번들러를 써서 ESM을 번들링하거나
* 동적 import를 사용:

```js
// CJS 파일 안에서
async function renderMarkdown(md) {
  const { marked } = await import('marked');
  return marked(md);
}
```

현실적으로는 “서버도 ESM으로 통일한다” 쪽이 장기 유지보수에는 더 안전합니다.

---

### 3-3. 16.1.0 – 파서/렌더러 제네릭 타입

16.1.0에서 Parser와 Renderer에 제네릭 타입이 들어가면서([jsDocs.io][4])

* `marked.parse` 결과를 “항상 string”으로 보던 관성이 조금 깨졌습니다.
* 커스텀 파서를 써서 “HTML 대신 다른 구조”를 만들고 싶은 경우
  타입 시스템이 이를 제대로 표현할 수 있게 됐습니다.

예를 들어, 직접 만든 AST 타입을 결과로 쓰고 싶다면:

```ts
type MyAst = { type: string; children?: MyAst[] };

const options: marked.MarkedOptions<MyAst, never> = {
  // parser/renderer 제네릭에 맞춰 구현
};
```

이렇게 하면 TS가 “여기는 HTML 문자열이 아니라 MyAst”라는 것을 알기 때문에
후속 파이프라인 코드에서 타입 안전성이 확 올라갑니다.

타입이 중요하지 않은 JS 프로젝트라면 크게 신경 쓸 부분은 아니고,
TS-heavy 환경에서는 “이제 좀 제대로 쓸 수 있게 됐다” 정도로 이해하면 됩니다.

---

### 3-4. 16.2.0 – Def 토큰·렌더러

16.2.0 릴리스 노트에는 “add def token in tokens and renderer”라고 적혀 있습니다.([GitHub][1])

그리고 jsdocs 기준으로 Renderer에 `def()`, Tokens 네임스페이스에 `Tokens.Def`가 존재합니다.([jsDocs.io][4])

이 말은:

* 이제 링크 정의 `[id]: https://example.com "title"` 같은 부분을
  토큰 레벨에서 정식으로 다룰 수 있고
* 커스텀 렌더러나 `walkTokens`로 이 정의들을 모아서
  별도의 인덱스, TOC, 레퍼런스 테이블을 만들기 쉬워졌다는 뜻입니다.

예상 사용 예시는 이런 식입니다.

* `walkTokens`에서 `token.type === 'def'`인 것만 수집해서
  “문서 안 모든 레퍼런스 링크 목록”을 만든다.
* Renderer.def를 구현해서, 특정 규칙에 맞는 정의는
  HTML에 별도의 앵커로 렌더링한다.

기존 코드가 Def를 직접 다루지 않았다면 깨지는 부분은 거의 없고,
“좀 더 세밀하게 다루고 싶은 사람을 위한 확장 포인트 추가”에 가깝습니다.

---

### 3-5. 16.3.0 – emStrongMask 훅

`emStrongMask` 설명은 공식 문서에서 이렇게 되어 있습니다.([marked.js.org][5])

* em/strong으로 파싱되면 안 되는 부분을 마스킹하기 위한 훅
* `Hooks.emStrongMask(src: string): string` 형태

이 훅이 좋은 경우:

* 수식이나 템플릿 문법 안의 밑줄, 별표를
  “강조 표시”가 아니라 그냥 문자로 취급하고 싶을 때
* 예를 들어 `{{ user_name }}` 같은 템플릿에서 `_name`이
  의도치 않게 em으로 파싱되는 것을 막고 싶을 때

아이디어만 잡자면 이런 느낌입니다.

```js
marked.use({
  hooks: {
    emStrongMask(src) {
      // 예: {{ ... }} 블록은 그대로 보존
      return src.replace(/\{\{[\s\S]+?\}\}/g, match => {
        // 여기서 match 내부의 *나 _를 안전한 토큰으로 바꿨다가
        // postprocess에서 다시 되돌리는 전략 등
        return match;
      });
    }
  }
});
```

즉, “강조 기호 해석을 일시적으로 꺼 두는 안전 스위치” 하나가 생긴 셈입니다.

---

### 3-6. 16.4.0 – async provideLexer / provideParser

16.4.0 릴리스에서 Features 부분에

> Add async provideParser provideLexer

가 올라와 있고, Marked 옵션 설명에서도 hooks의 `provideLexer`와 `provideParser`가
“토크나이저/파서 함수를 제공하는 훅”이라고 정리되어 있습니다.([GitHub][1])

여기서 중요한 포인트는 두 가지입니다.

1. 토크나이저와 파서를 “완전히 다른 구현”으로 갈아끼울 수 있다.
2. 그 과정에서 비동기 로직도 공식적으로 지원된다.

예를 들면 이런 시나리오를 상상할 수 있습니다.

* 마크다운 안에 `:user:1234:` 같은 토큰이 등장하면

  * provideLexer / provideParser가 백엔드 API를 호출해
    “이 유저의 닉네임·아바타”를 가져오고
  * 그 정보를 반영한 토큰·AST를 만든 다음
  * 최종 HTML을 만든다.

기존에는 이런 걸 하려면

* marked 밖에서 선처리(preprocess)를 하거나
* 동기식 훅에서 “강제로 동기 IO”처럼 쓰는 기묘한 우회가 필요했는데

16.4.0 이후에는 “hooks에서 공식적으로 async를 허용”하는 쪽으로 구조가 정리된 셈입니다.

다만 시그니처가 꽤 복잡하니, 여기서는 개념만 잡고
실제 구현은 공식 타입 정의와 문서를 보면서 맞추는 쪽이 안전합니다.

---

### 3-7. 17.0.0 – 리스트·체크박스 토큰 구조 재정비

17.0.0 릴리스의 BREAKING CHANGES를 그대로 요약하면 이렇습니다.([NewReleases][3])

* 연속된 텍스트 토큰이 리스트 안에서 처리되는 방식 변경
* listItem 렌더러 단순화
* 리스트 토크나이저에 Checkbox 토큰 추가
* Checkbox 토큰에 type, raw 속성 추가
* “loose list”의 텍스트 토큰을 단순 텍스트가 아니라 Paragraph 토큰으로 변경

jsdocs 기준으로는 Tokens.Checkbox, Renderer.checkbox, TextRenderer.checkbox 등이 보입니다.([jsDocs.io][4])

이게 의미하는 바를 현업 관점에서 정리하면:

1. 리스트 관련 커스텀 렌더링을 많이 건드린 프로젝트는 영향이 크다.

   * 특히 task list
     `- [x] done`
     `- [ ] todo`
     쪽에서 토큰 구조가 달라졌을 가능성이 높습니다.
2. `walkTokens`에서 “리스트 아이템 안의 텍스트 토큰”을 직접 뒤지는 로직은
   이제 Paragraph나 Checkbox 같은 새 토큰 구조를 고려해야 합니다.
3. 좋은 뉴스는 “체크박스를 토큰 레벨에서 명확하게 구분”하게 됐다는 점입니다.

   * 예전에는 정규식이나 텍스트 파싱으로 “[x]”를 찾아야 했다면
   * 지금은 Tokens.Checkbox를 기준으로 더 깨끗한 로직을 짤 수 있습니다.

간단한 활용 예시는 이런 느낌이 될 수 있습니다.

```js
import { marked } from 'marked';

const renderer = new marked.Renderer();

renderer.checkbox = function (checked) {
  // 여기서 원하는 HTML로 커스터마이즈
  return `<input type="checkbox" disabled ${checked ? 'checked' : ''}>`;
};

marked.use({ renderer });

const html = marked('- [x] done\n- [ ] todo');
```

실제 Tokens.Checkbox의 전체 필드는 타입 정의를 보고 맞춰야 하지만,
최소한 “Renderer.checkbox로 체크박스 출력 커스터마이즈”는 공식 API로 보장됩니다.([jsDocs.io][4])

리스트 관련 마이그레이션 체크 리스트를 짧게 정리하면:

* 커스텀 list / listitem / checkbox 렌더러가 있다면 17에서 한 번 다 실행해 보기
* `walkTokens`에서 `token.type === 'text'`만 보던 코드는
  Paragraph, Checkbox, ListItem 등도 함께 고려하도록 수정
* task list를 텍스트로 후처리하던 부분이 있다면
  이제는 Tokens.Checkbox를 기준으로 다시 설계하는 편이 더 안정적

---

## 4. 정리하면, 버전 올릴 때 어디를 봐야 하나

실제 프로젝트에서 버전 업그레이드를 고민한다면 이렇게 생각하면 편할 것 같습니다.

* 14.x → 15.x

  * 거의 모든 파이프라인이 그대로 동작하지만
    “토큰을 직접 만지작거리던 확장 코드”는 HTML 이스케이프 관점에서 한 번 점검.
* 15.x → 16.x

  * 런타임 환경 점검이 먼저: Node 20+인지, ESM으로 돌릴 수 있는지.
  * 서버 전체의 모듈 시스템 전략과 맞물리기 때문에, 여기서 한 번 아키텍처 리셋을 고민할 타이밍.
* 16.x → 17.x

  * 리스트·체크박스 커스터마이징을 해뒀다면 집중 점검.
  * 대신 “체크박스·Def·emStrongMask·async hooks”까지 합치면
    마크다운을 꽤 복잡하게 확장할 수 있는 도구 세트가 갖춰진 상태라
    이후에는 기능을 적극적으로 활용해도 좋음.

---

[1]: https://github.com/markedjs/marked/releases?utm_source=chatgpt.com "Releases · markedjs/marked"
[2]: https://github.com/markedjs/marked/releases?page=2 "Releases · markedjs/marked · GitHub"
[3]: https://newreleases.io/project/yarn/marked/release/17.0.0?utm_source=chatgpt.com "marked 17.0.0 on Node.js Yarn"
[4]: https://www.jsdocs.io/package/marked "marked@17.0.1 - jsDocs.io"
[5]: https://marked.js.org/using_pro?utm_source=chatgpt.com "Using Pro - Marked Documentation"
