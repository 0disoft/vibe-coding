# Marked.js 14~17 릴리스 정리 (2024-09-13~2025-12-07)

2024-09-13 이후 marked는 세 번의 큰 변곡을 겪었습니다.

* 15.0.0: HTML 이스케이프 위치 변경
* 16.0.0: CJS 제거 + 최소 Node 20으로 상향(ESM 시대로 전환)
* 17.0.0: 리스트·체크박스 토큰 재정비

나머지 릴리스는 이 세 흐름을 보완하는 패치/확장에 가깝습니다.

---

## 1. 릴리스 타임라인 (공식 GitHub Releases 기준)

| 날짜 | 버전 | 타입 | 한줄 요약 |
| --- | --- | --- | --- |
| 2024-10-15 | 14.1.3 | 패치 | em/strong 마스킹, CLI 도움말 관련 버그 수정 |
| 2024-11-07 | 14.1.4 | 패치 | 토큰 텍스트 변경 방지 등 버그 수정 |
| 2024-11-09 | 15.0.0 | 메이저 | HTML 이스케이프 위치 변경, 여러 파서 수정 (브레이킹) |
| 2024-11-18 | 15.0.1 | 패치 | 회귀 버그 수정 |
| 2024-11-20 | 15.0.2 | 패치 | 추가 버그 수정 |
| 2024-11-29 | 15.0.3 | 패치 | 버그 수정·안정화 |
| 2024-12-15 | 15.0.4 | 패치 | 버그 수정·안정화 |
| 2025-01-02 | 15.0.5 | 패치 | 버그 수정 |
| 2025-01-06 | 15.0.6 | 패치 | 버그 수정 |
| 2025-02-10 | 15.0.7 | 패치 | 버그 수정 |
| 2025-04-07 | 15.0.8 | 패치 | 버그 수정 |
| 2025-04-21 | 15.0.9 | 패치 | 버그 수정 |
| 2025-04-23 | 15.0.10 | 패치 | 버그 수정 |
| 2025-04-25 | 15.0.11 | 패치 | 버그 수정 |
| 2025-05-20 | 15.0.12 | 패치 | 버그 수정 |
| 2025-06-27 | 16.0.0 | 메이저 | CJS 빌드 제거, 최소 Node 20으로 상향 (브레이킹) |
| 2025-07-17 | 16.1.0 | 마이너 | 파서 제네릭 타입 추가(타입 시스템 개선) |
| 2025-07-18 | 16.1.1 | 패치 | em/strong 토큰 버그 수정 |
| 2025-08-04 | 16.1.2 | 패치 | 멀티라인 리스트 아이템 개행 처리 수정 |
| 2025-08-18 | 16.2.0 | 마이너 | Tokens.Def 및 Renderer.def 추가 |
| 2025-08-27 | 16.2.1 | 패치 | 링크 텍스트의 이스케이프된 개행 허용 |
| 2025-09-14 | 16.3.0 | 마이너 | emStrongMask 훅 추가 |
| 2025-10-07 | 16.4.0 | 마이너 | async provideParser / provideLexer 훅 추가 |
| 2025-10-17 | 16.4.1 | 패치 | 백틱 우선순위 버그 수정 |
| 2025-11-06 | 16.4.2 | 패치 | 정규식 lookbehind 회피(브라우저 호환 개선) |
| 2025-11-07 | 17.0.0 | 메이저 | 리스트·체크박스 토큰 구조 변경 (브레이킹) |
| 2025-11-20 | 17.0.1 | 패치 | task item 내부 블록 요소 버그 수정 |

---

## 2. 코드 영향이 큰 변경만 추린 요약

| 버전 | 유형 | 핵심 내용 | 코드 영향 | 대응·마이그레이션 |
| --- | --- | --- | --- | --- |
| 15.0.0 | 브레이킹 | HTML 이스케이프를 토크나이저 → 렌더러로 이동 | 토큰 text를 직접 쓰면 이스케이프 수준 달라짐(덜/더 이스케이프 가능) | 토큰을 직접 출력하지 말고 Renderer를 거치기, 커스텀 렌더러 이중 이스케이프 점검 |
| 16.0.0 | 브레이킹 | CJS 빌드 제거, 최소 Node 20 | `require('marked')` 깨질 수 있음, 구 Node 미지원 | ESM import로 전환, CJS 환경은 동적 import/번들링 활용 |
| 16.1.0 | 타입 | Parser/Renderer 제네릭 타입 | TS에서 결과/커스텀 AST 타입을 정확히 모델링 가능 | 제네릭 파라미터 명시로 타입 안정성 확보 |
| 16.2.0 | 기능 | Tokens.Def·Renderer.def 도입 | 링크 정의를 토큰 레벨에서 정식 처리 가능 | walkTokens/커스텀 렌더러로 레퍼런스 맵·메타데이터 구축 |
| 16.3.0 | 기능 | emStrongMask 훅 | 특정 구간의 em/strong 파싱 제외 가능 | 수식·템플릿 영역 마스킹에 활용 |
| 16.4.0 | 기능 | async provideLexer/Parser | 토크나이저·파서를 비동기로 교체 가능 | 원격 데이터 연동, DB 기반 확장 마크다운 구현 시 유용 |
| 17.0.0 | 브레이킹 | 리스트/체크박스 토큰 재정비 | list/listItem/checkbox 커스텀 렌더러·walkTokens 로직 영향 | Tokens.Checkbox·ListItem 구조 기준으로 재작성, Paragraph 포함 여부 확인 |

---

## 3. 버전별 상세 포인트

### 15.0.0: HTML 이스케이프 위치 이동

* 토크나이저가 하던 이스케이프를 렌더러가 담당.
* 토큰 값을 직접 innerHTML 등에 꽂던 코드는 더 이상 “이미 이스케이프됨”을 가정하면 위험.
* 커스텀 렌더러가 추가로 escape를 호출한다면 이중 이스케이프 가능성 점검.

가급적 Renderer 경로로 출력하고, 토큰 원본/이스케이프 여부를 주석이나 타입으로 명시해 두는 편이 안전합니다.

### 16.0.0: ESM 전환 + Node 20+

* CJS 빌드 제거, 최소 Node 20.
* `require('marked')`는 깨질 수 있으니 ESM import로 전환:

```js
import { marked } from 'marked';
const html = marked('# Hello');
```

* CJS만 가능한 환경이면 동적 import로 우회:

```js
async function renderMarkdown(md) {
  const { marked } = await import('marked');
  return marked(md);
}
```

### 16.1.0: 파서/렌더러 제네릭 타입

* Parser/Renderer에 제네릭이 추가돼 결과물을 HTML 이외의 타입으로 엄격히 정의 가능.
* 커스텀 AST를 만들고 싶다면 제네릭 파라미터를 명시해 타입 안정성을 확보.

### 16.2.0: Def 토큰/렌더러

* `[id]: url "title"` 링크 정의가 Tokens.Def·Renderer.def로 정식 지원.
* `walkTokens`에서 def를 수집해 문서 레퍼런스 인덱스, TOC 등을 만들기 쉬워짐.

### 16.3.0: emStrongMask 훅

* `Hooks.emStrongMask(src: string): string`.
* 수식·템플릿 블록 등에서 `*`/`_`가 강조로 해석되지 않게 마스킹 가능.

### 16.4.0: async provideLexer / provideParser

* 렉서·파서를 완전히 교체하면서 비동기 로직 사용 가능.
* 예: 토큰화 과정에서 API/DB 조회 후 결과를 토큰에 반영하는 커스텀 마크다운 구현.

### 17.0.0: 리스트·체크박스 토큰 재정비

* 리스트 내부 텍스트 처리 방식 변경, listItem 렌더러 단순화.
* Checkbox 토큰 추가(타입, raw 포함), loose list 텍스트를 Paragraph 토큰으로 처리.
* 커스텀 list/listItem/checkbox 렌더러나 `walkTokens` 로직은 Tokens.Checkbox·Tokens.ListItem 구조에 맞춰 재작성 필요.

```js
import { marked } from 'marked';

const renderer = new marked.Renderer();
renderer.checkbox = checked => `<input type="checkbox" disabled ${checked ? 'checked' : ''}>`;
marked.use({ renderer });

const html = marked('- [x] done\n- [ ] todo');
```

---

## 4. 업그레이드 판단 가이드

* 14.x → 15.x: 토큰을 직접 만지는 확장 코드라면 HTML 이스케이프 처리 여부 점검.
* 15.x → 16.x: 런타임 전략 점검이 우선. Node 20+ 확보, 모듈 시스템 ESM 전환 여부 결정.
* 16.x → 17.x: 리스트/체크박스 커스터마이징·후처리 코드 집중 검증. 새 토큰 구조에 맞춰 walkTokens·렌더러 수정.

---
