# PortOne 주요 변경 사항 요약 및 대응 전략 (2024-11 ~ 2025-12)

PortOne은 2024년 11월부터 2025년 12월까지 API 계약의 큰 파괴적 변경 없이 **'멀티 PG 채널 연동의 정교화'**와 **'테스트 환경 관리의 표준화'**에 집중했습니다. 핵심 변화는 레거시 `pg` 파라미터의 퇴장과 Platform API의 테스트 환경 분리입니다.

---

## 1. Executive Summary: 핵심 변경 사항 (v0.1.0, 2025-10-02)

| 영역                | 핵심 변화 (Critical Change)                                                  | 영향도 | 대체 전략                                                  |
| :------------------ | :--------------------------------------------------------------------------- | :----- | :--------------------------------------------------------- |
| **브라우저 SDK**    | `pg` 파라미터 (v1 JS SDK) Deprecation 및 `channelKey`로 전환                 | 높음   | 콘솔에서 **채널 키**를 설정하고, SDK에는 키만 전달해야 함. |
| **Platform API**    | **`isForTest` 필드 Deprecation** 및 `test` 쿼리 파라미터로 전환 (2025-10-02) | 중간   | 서버 API 호출 시 **쿼리 파라미터**로 테스트 환경 명시.     |
| **브라우저 SDK v2** | Enum 타입 구조 개선 및 `discriminated union` 제거                            | 중간   | TypeScript 코드의 **타입 가드 분기** 로직 점검 및 수정.    |
| **레거시 PG**       | 지원 종료된 PG (JTNET, SYRUP 등) 관련 레거시 코드 제거 (v0.0.8)              | 낮음   | 해당 PG를 쓰던 코드는 **반드시 제거**해야 함.              |

---

## 2. Critical Action Items: 코드 및 추상화 전략

### 2-1. 테스트 환경 분리 표준화 (Platform API, 2025-10-02)

파트너 정산 자동화(Platform API)를 사용한다면 테스트 환경 지정 방식을 즉시 전환해야 합니다.

- **Deprecated:** 요청 Body의 **`isForTest`** 필드
- **Replacement:** 쿼리 파라미터 **`?test=true`** 또는 **`?test=false`**
- **Action:** 공통 서버 클라이언트 레이어에서 테스트 여부를 항상 **쿼리 파라미터**로 전달하도록 수정하십시오. Body의 `isForTest`는 향후 완전히 제거될 예정이므로 사용을 중단해야 합니다.

### 2-2. 브라우저 연동 모델 전환 (v2 SDK)

레거시 v1 JS SDK의 `pg` 파라미터를 버리고, v2 브라우저 SDK의 **채널 기반 연동**으로 전환해야 합니다.

- **채널 키 필수화:** `channelKey`를 사용하여 PortOne 관리 콘솔에서 미리 정의된 PG 및 채널 설정을 불러와야 합니다. PG 이름(예: `html5_inicis`)을 코드에 하드코딩하는 방식은 지양해야 합니다.
- **타입 가드 리팩토링:** 브라우저 SDK v2의 v0.1.0 패치에서 `discriminated union` 타입이 제거되었습니다. TypeScript 코드가 이 타입 가드에 의존하여 결제 플로우를 분기하고 있었다면, 일반적인 **옵셔널/널 체크 로직**으로 변경해야 합니다.

### 2-3. 레거시 패키지 청산

- **Node.js/Server-side:** 레거시 `portone` 패키지 사용을 중단하고, 최신 `@portone/server-sdk`로 전환하십시오.
- **지원 중단 PG 정리 (v0.0.8):** 브라우저 SDK v0.0.8에서 JTNET, SYRUP, 구 Kakao 등 **지원 중단된 PG 관련 레거시 로직이 제거**되었습니다. 해당 PG를 쓰는 코드는 즉시 제거하거나, 지원되는 PG로 교체해야 합니다.

---

## 3. Strategic Adoption: 도입해야 할 신규 패턴

- **수동 승인 플로우 (v0.1.0):** 결제 및 빌링키 발급 시 **'수동 승인'** 플로우를 명시적으로 제어할 수 있는 옵션이 추가되었습니다. 자동 승인이 아닌, 후처리 검증이 필요한 비즈니스 로직에 활용하십시오.
- **UI 제어 강화 (v0.0.12, v0.0.23):** `popup` 및 `iframe` 옵션을 활용하여 결제 UI의 표시 모드를 명시적으로 제어할 수 있습니다. 모바일 웹뷰 등 커스텀 환경에서 UI 충돌을 피하는 데 유용합니다.

---

## 4. Conclusion

PortOne 연동의 핵심은 **"채널 중심 추상화"**와 **"테스트 환경의 명시적 분리"**입니다. **Platform API 호출 시 `?test` 쿼리 파라미터 사용**을 표준화하고, **브라우저 SDK는 `channelKey` 기반**으로 전환하여 코드의 유연성과 유지보수성을 확보하십시오. 모든 신규 연동은 **developers.portone.io**의 최신 개발자센터 문서를 기준으로 설계해야 합니다.
