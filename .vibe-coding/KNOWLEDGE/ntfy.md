# ntfy: 2024년 11월 ~ 2025년 11월 주요 아키텍처 변화 및 실무 가이드

ntfy 서버는 2024년 11월부터 2025년 11월까지 **v2.12.0부터 v2.15.0**까지 4개 마이너 릴리스를 통해 **'GitOps 기반의 인프라스트럭처 관리'**와 **'고급 알림 기능의 정교화'**에 집중했습니다. 이 기간 동안 API의 제거는 없었으나, 설정 파일 기반의 **선언적 계정/ACL 관리**가 도입되어 운영 방식을 근본적으로 변화시켰습니다.

---

## 1. Executive Summary: 핵심 아키텍처 변화 (v2.12.0 - v2.15.0)

| 버전        | 릴리즈 시기 | 핵심 아키텍처 변화 (Architectural Impact)                                    | 영향도    |
| :---------- | :---------- | :--------------------------------------------------------------------------- | :-------- |
| **v2.14.0** | '25.08      | **GitOps & IaC:** **선언적 사용자, ACL, 토큰 관리** 지원. (운영 방식 변화)   | 매우 높음 |
|             |             | **Templating:** Sprig 기반 함수 지원. 복잡한 JSON 페이로드 가공 능력 확보.   | 중간      |
| **v2.13.0** | '25.07      | **Networking:** IPv6 정식 지원 및 프록시 헤더 기반 Rate Limiting 도입.       | 중간      |
| **v2.12.0** | '25.05      | **Security & UX:** 이메일 발행 인증 지원. WebPush 키 및 만료 정책 관리 강화. | 중간      |
| **v2.15.0** | '25.11      | **Access Control:** 토픽별 `require-login` 플래그 추가. (권한 모델 정교화)   | 중간      |

---

## 2. Critical Action Items: 운영 및 인프라 필수 점검

### 2-1. 선언적 인프라 관리 (v2.14.0)

ntfy는 사용자, ACL, 토큰을 **설정 파일(YAML)**에서 선언적으로 정의하는 기능을 도입했습니다.

- **Action:** 기존에 CLI나 API로 수동 관리하던 **모든 사용자, 토큰, ACL 정의**를 서버 설정 파일(예: `server.yml`)로 마이그레이션하십시오. 이 파일을 Git에 통합하여 **GitOps 기반의 계정/권한 관리**를 구현해야 합니다.
- **Token Security:** `NTFY_PASSWORD_HASH` 환경 변수를 활용하여, 배포 스크립트에 평문 비밀번호 대신 미리 해시된 비밀번호를 전달하도록 보안 파이프라인을 구축하십시오.

### 2-2. 알림 템플릿 및 가공 (v2.14.0)

- **Sprig 함수 활용:** JSON Webhook 등으로 복잡한 페이로드가 들어올 경우, Sprig 기반의 템플릿 함수(예: `toJSON`, `trim`, `splitList`)를 사용하여 JSON 필드를 **ntfy 메시지 제목/본문**에 맞게 가공하십시오.
- **템플릿 분리:** `tpl` 파라미터를 활용하여 다양한 알림 유형(예: 에러, 경고, 정보)에 맞는 템플릿을 미리 정의하고, 발행 요청 시 해당 템플릿을 선택적으로 적용하십시오.

### 2-3. 네트워크 및 구독 전략 (v2.13.0, v2.12.0)

- **IPv6 및 Rate Limit:** self-hosted 환경에서 IPv6를 활성화하려면 `listen-http` 설정을 조정해야 합니다. 또한 ntfy 앞단에 리버스 프록시(Nginx, Caddy 등)를 사용하는 경우, `proxy-forwarded-header`를 설정하여 실제 클라이언트 IP 기준으로 Rate Limit가 동작하도록 보정하십시오.
- **`since=latest` 채택:** 상태 모니터링(예: 서버 상태)처럼 "가장 최근 값만 중요한" 토픽의 구독자들은 `since=<timestamp>` 대신 **`since=latest`**를 사용하여 오프라인 복구 시 대량의 과거 메시지 조회로 인한 부하를 방지하십시오.

---

## 3. Strategic Adoption: 도입해야 할 신규 패턴

- **토픽별 로그인 강제 (v2.15.0):** 웹 앱을 통해 토픽을 구독하는 경우, 민감한 토픽에 대해 `require-login` 플래그를 활성화하여 익명 접근을 차단하십시오.
- **자동화 파이프라인 (v2.13.0):** `ntfy publish`의 STDIN 지원을 활용하여 `long-running-command | ntfy publish mytopic` 형태로 CLI 파이프라인의 결과를 바로 알림으로 전환하는 스크립트를 구축하십시오.

---

## 4. Conclusion

ntfy v2.12+는 **선언적 설정(v2.14.0)**과 **WebPush 인증 강화(v2.12.0)**를 통해 엔터프라이즈 알림 시스템으로의 기반을 다졌습니다. **GitOps 기반으로 사용자 및 ACL을 관리**하고 **Sprig 템플릿**을 활용하여 알림 메시지의 품질을 높이는 것이 이번 업그레이드의 핵심 전략입니다.
