# Cap (2025 Release) - 주요 변경 사항 및 개발자 가이드

Cap은 2025년부터 본격적으로 릴리스가 시작된 프로젝트로, 주요 버전 히스토리는 2025년에 집중되어 있습니다. 이 문서는 2025년의 주요 패키지 버전 타임라인과 개발자 관점에서 중요한 변경 사항을 정리한 것입니다.

---

## 1. Cap 주요 버전 타임라인 (2025년, 요약)

Cap은 모노레포 구조로 `widget`, `server`, `standalone` 패키지가 개별적으로 버전을 관리합니다.

> **참고:** 날짜는 GitHub 릴리스 날짜 기준입니다.

| 날짜 (2025) | 패키지 | 버전 | 변경 사항 |
| :--- | :--- | :--- | :--- |
| **10-19** | `standalone` | `2.0.12` | 더 현대적인 서버 버전으로 마이그레이션 |
| **10-25** | `standalone` | `2.0.13` | 레이트 리밋팅(Rate Limiting) 동작 개선 |
| **10-25** | `standalone` | `2.0.14` | `DB_CONNECTOR` 환경 변수 지원 (`turso`, `bun-sqlite`) |
| **10-25** | `standalone` | `2.0.15` | 커넥터 스위칭 버그 수정 |
| **10-25** | `standalone` | `2.0.16` | 초기 쿼리(init queries) `await` 처리 로직 수정 |
| **10-30** | `widget` | `0.1.31` | UI 및 동작 개선 (PR #123) |
| **11-12** | `standalone` | `2.0.17` | Bun SQL 기반 SQLite로 변경, Postgres/MySQL 지원 추가 |
| **11-18** | `standalone` | `2.0.18` | 내부 안정화 및 개선 (PR #135) |
| **11-25** | `server` | `4.0.4` | 서버 검증 로직 관련 버그 수정 (#140) |
| **11-30** | `widget` | `0.1.32` | 진행 원(Progress Circle) 애니메이션 및 디자인 개선 |

---

## 2. 개발자 필독: 코드에 영향을 주는 주요 변경 사항

단순 버그 수정이나 성능 튜닝을 제외하고, 실제 개발 및 연동에 영향을 주는 변경 사항을 정리했습니다.

### 2-1. `standalone@2.0.12` (2025-10-19)

* **변경 내용:** 더 현대적인 서버 버전으로 마이그레이션
* **개발자 영향:**
  * 내부 HTTP 서버/러너 교체 (API 시그니처 유지).
  * 리버스 프록시(Nginx, Cloudflare 등) 사용 시 타임아웃, 헤더 제한, HTTP/2 설정 확인 필요.
  * 로그 포맷의 미세한 변경 가능성 점검.

### 2-2. `standalone@2.0.13` (2025-10-25)

* **변경 내용:** 레이트 리밋팅 개선
* **개발자 영향:**
  * 내부 알고리즘 교체 또는 파라미터 튜닝.
  * 외부 레이트 리밋(Cloudflare 등)과 중첩될 경우 요청 차단 빈도 테스트 필요.

### 2-3. `standalone@2.0.14` – `DB_CONNECTOR` 도입 (2025-10-25)

* **변경 내용:** `DB_CONNECTOR` 환경 변수 추가 (`turso`, `bun-sqlite`)
* **개발자 영향:**
  * `DB_CONNECTOR`를 명시적으로 설정하여 데이터 저장소(도전 과제, 세션 등) 지정 가능.
  * 환경별 설정 예시:

```bash
# Turso (분산 환경 권장)
DB_CONNECTOR=turso
DB_URL="libsql://xxx.turso.io"
DB_AUTH_TOKEN="secret-token"

# Bun SQLite (로컬/단일 서버 권장)
DB_CONNECTOR=bun-sqlite
DB_PATH="./cap.db"
```

* **권장 사항:** 향후 기본값 변경 가능성에 대비해 `DB_CONNECTOR`를 명시적으로 설정하는 것이 안전합니다.

### 2-4. `standalone@2.0.15` ~ `2.0.16` – 커넥터 안정화

* **변경 내용:** 커넥터 스위칭 버그 및 초기 쿼리 레이스 컨디션 수정
* **개발자 영향:**
  * `standalone` 사용 시 최소 `2.0.16` 이상 버전 사용 권장.
  * 서버 부팅 직후 첫 검증 실패 문제가 해결됨.

### 2-5. `standalone@2.0.17` – RDB 지원 확장 (2025-11-12)

* **변경 내용:** Bun SQL 기반으로 전환, Postgres/MySQL 지원 추가
* **개발자 영향:**
  * Postgres 등을 백엔드로 사용 가능 (Docker + Postgres 조합 등).
  * 고부하 환경에서 Bun SQL의 비동기 이점(I/O 블로킹 감소) 활용 가능.
  * 기존 SQLite에서 RDB로 마이그레이션 시 데이터 이관 전략 필요.

### 2-6. `server@4.0.4` – 검증 로직 수정 (2025-11-25)

* **변경 내용:** 검증 실패 또는 예외 발생 케이스 수정 (#140)
* **개발자 영향:**
  * `@cap.js/server` 4.x 사용자라면 `4.0.4` 이상으로 업데이트 권장.
  * 민감한 환경의 경우 `verify()` 엔드포인트 테스트 필요.

### 2-7. `widget` 0.1.31 ~ 0.1.32 – UI 개선

* **변경 내용:** 진행 원 애니메이션 및 UI 디자인 부드럽게 변경
* **개발자 영향:**
  * 커스텀 CSS로 위젯 스타일을 덮어쓴 경우 디자인 깨짐 확인 필요.
  * 서버 통신 방식은 유지됨.

---

## 3. 요약 및 권장 설정 (SvelteKit + Bun 스택)

SvelteKit + Bun 환경에서 Cap을 도입할 때 권장하는 설정입니다.

1. **Standalone 버전:** 최소 `2.0.17` 이상 권장 (RDB 지원 및 안정성).
2. **데이터베이스:**
   * 분산 환경/프로덕션: `DB_CONNECTOR=turso` 또는 Postgres 사용.
   * 로컬/단일 인스턴스: `DB_CONNECTOR=bun-sqlite`.
3. **환경 변수:** `.env`에 `DB_CONNECTOR`를 명시적으로 선언.
4. **라이브러리:**
   * `@cap.js/server`: `4.0.4` 이상 권장.
   * `@cap.js/widget`: 최신 버전 권장 (CSS 호환성 확인).

Cap 프로젝트는 2025년부터 본격적인 릴리스가 이루어졌으므로, 이전 버전보다는 2025년 이후의 최신 버전을 기준으로 도입하는 것이 가장 안전합니다.
